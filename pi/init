#!/bin/sh -e
# Initializes the RaspiCopter completely

# Prepare our UART
stty -F /dev/ttyAMA0 cs8 115200 ignbrk -brkint -icrnl -imaxbel -opost -onlcr -isig -icanon -iexten -echo -echoe -echok -echoctl -echoke noflsh -ixon -crtscts

# Init our low-level control
modprobe i2c-dev
./msp reset
  
# this will put the MPU6050 into 6-DOF DMP mode
while ! ./initIMU; do 
  ./msp initdmp
  ./msp reset
  sleep 1s; 
done
sleep 0.3s
./msp initdmp # this initializes the MPU

# Init PID controllers
sleep 0.3s
./msp mode= 0 # OFF!

#./msp typr= 0.0 0.0 0.0 0.0
#./msp pidmask= 10010111 # only allow speed control

./msp typr= 0.0 0.0 0.0 66.0
./msp pidmask= 10010001 # only disable yaw, and the TL/BR motors
./msp pid= 0 35 5 0.0 0 0 -33 33 # yaw
./msp pid= 1 35 5 0.0 0 0 -33 33 # pitch
./msp pid= 2 35 5 0.0 0 0 -33 33 # roll
./msp mode= 1

echo "Press ENTER to stop"
read foo
./msp cut
